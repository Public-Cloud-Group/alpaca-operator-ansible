---
# ALPACA Operator Variables
# Generated from CSV data - Total Systems: {{ csv_data | length }}
# Generated at: {{ ansible_date_time.iso8601 }}

# ALPACA API Configuration
ALPACA_Operator_API_Protocol: {{ alpaca_api.protocol }}
ALPACA_Operator_API_Port: {{ alpaca_api.port }}
ALPACA_Operator_API_Username: {{ alpaca_api.username }}
ALPACA_Operator_API_Password: {{ alpaca_api.password }}
ALPACA_Operator_API_Validate_Certs: {{ alpaca_api.tls_verify | lower }}

# System-specific variables
{% for row in csv_data %}
# {{ row.system_name }} Configuration
{{ row.system_name | replace(' ', '_') | lower }}_system_name: {{ row.system_name }}
{{ row.system_name | replace(' ', '_') | lower }}_agent_name: {{ row.agent_name }}
{{ row.system_name | replace(' ', '_') | lower }}_system_type: {{ row.system_type }}
{{ row.system_name | replace(' ', '_') | lower }}_hdb_nw_sid: {{ row.hdb_nw_sid }}
{{ row.system_name | replace(' ', '_') | lower }}_system_az: {{ row.system_az }}
{{ row.system_name | replace(' ', '_') | lower }}_system_sla: {{ row.system_sla }}
{{ row.system_name | replace(' ', '_') | lower }}_primary_system: {{ row.primary_system }}
{{ row.system_name | replace(' ', '_') | lower }}_hdb_tenant: {{ row.hdb_tenant }}
{{ row.system_name | replace(' ', '_') | lower }}_system_staging: {{ row.system_staging }}
{{ row.system_name | replace(' ', '_') | lower }}_system_vm_type: {{ row.system_vm_type }}
{{ row.system_name | replace(' ', '_') | lower }}_system_vm_flavor: {{ row.system_vm_flavor }}
{{ row.system_name | replace(' ', '_') | lower }}_hdb_data_min: {{ row.hdb_data_min }}
{{ row.system_name | replace(' ', '_') | lower }}_hdb_data_max: {{ row.hdb_data_max }}
{{ row.system_name | replace(' ', '_') | lower }}_hdb_log_min: {{ row.hdb_log_min }}
{{ row.system_name | replace(' ', '_') | lower }}_hdb_log_max: {{ row.hdb_log_max }}
{{ row.system_name | replace(' ', '_') | lower }}_hdb_shared_min: {{ row.hdb_shared_min }}
{{ row.system_name | replace(' ', '_') | lower }}_hdb_shared_max: {{ row.hdb_shared_max }}
{{ row.system_name | replace(' ', '_') | lower }}_instance_no: {{ row.Instance_no }}

{% endfor %}

# SLA Group Variables
{% set sla1_systems = csv_data | selectattr('system_sla', 'equalto', 'SLA1') | list %}
{% if sla1_systems | length > 0 %}
sla1_systems:
{% for row in sla1_systems %}
  - {{ row.system_name }}
{% endfor %}
{% endif %}

{% set sla2_systems = csv_data | selectattr('system_sla', 'equalto', 'SLA2') | list %}
{% if sla2_systems | length > 0 %}
sla2_systems:
{% for row in sla2_systems %}
  - {{ row.system_name }}
{% endfor %}
{% endif %}

{% set sla3_systems = csv_data | selectattr('system_sla', 'equalto', 'SLA3') | list %}
{% if sla3_systems | length > 0 %}
sla3_systems:
{% for row in sla3_systems %}
  - {{ row.system_name }}
{% endfor %}
{% endif %}

{% set sla4_systems = csv_data | selectattr('system_sla', 'equalto', 'SLA4') | list %}
{% if sla4_systems | length > 0 %}
sla4_systems:
{% for row in sla4_systems %}
  - {{ row.system_name }}
{% endfor %}
{% endif %}

# Summary Statistics
total_systems: {{ csv_data | length }}
sla1_count: {{ csv_data | selectattr('system_sla', 'equalto', 'SLA1') | list | length }}
sla2_count: {{ csv_data | selectattr('system_sla', 'equalto', 'SLA2') | list | length }}
sla3_count: {{ csv_data | selectattr('system_sla', 'equalto', 'SLA3') | list | length }}
sla4_count: {{ csv_data | selectattr('system_sla', 'equalto', 'SLA4') | list | length }}

# System Types
{% set system_types = csv_data | map(attribute='system_type') | unique | list %}
system_types:
{% for system_type in system_types %}
  - {{ system_type }}
{% endfor %}

# Availability Zones
{% set availability_zones = csv_data | map(attribute='system_az') | unique | list %}
availability_zones:
{% for az in availability_zones %}
  - {{ az }}
{% endfor %} 