---
- name: HANA Backup - Generate and Execute Commands from CSV
  hosts: local
  gather_facts: false

# ToDo:
# - Hier möchte ich zum einen "global", also für alle SLAs Variablen und Parameter definieren können, die in der späteren Verarbeitung immer vorang haben (ist shcon implementiert)
# - Und ich möchte auch für jede einzelne SLA  und den darin befindlichen command (1...n) die Parameter definieren können, damit ich die Rolle an sich NIE anpassen muss.

  vars:
    csv_file: "{{ playbook_dir }}/.tmp/swm_prod.csv"
    # output_dir: "{{ playbook_dir }}/generated_commands"
    # cleanup_generated_playbooks: false                          # Controls whether generated command playbooks are deleted after execution


    # In this playbook we can override the defaults for all generated commands (except: agentId, agentName, systemId, systemName, name - Those are always generated with the given information in the CSV)
    # command:
    #   # --- Process configuration ---
    #   # processId: 801                                          # Optional if processCentralId is used
    #   # processCentralId: 8990048                               # Optional if processId is used
    #   # --- Command parameters definition ---
    #   parameters: "-p GLTarch -s <BKP_LOG_SRC> -l 4 -d <BKP_LOG_DEST1> -r <BKP_LOG_DEST2> -b <BKP_LOG_CLEANUP_INT> -t <BKP_LOG_CLEANUP_INT2> -h DB_HOST"
    #   # --- Scheduling configuration ---
    #   schedule:
    #     period: manually                                        # Options: manually, cron_expression, every_5min, fixed_time, etc.
    #     time: "12:12:12"                                        # Required for fixed_time or fixed_time_once
    #     cronExpression: ""                                      # Required if period is 'cron_expression'
    #     daysOfWeek:                                             # Optional: days when the command should run
    #       - monday
    #       - sunday
    #       - wednesday
    #   # --- Command flags ---
    #   parametersNeeded: false
    #   disabled: true                                            # Set to true to disable the command
    #   critical: true                                            # Indicates if command is critical
    #   autoDeploy: false
    #   # --- Command history retention ---
    #   history:
    #     documentAllRuns: false                                  # Whether to log all executions
    #     retention: 200
    #   # --- Timeout configuration ---
    #   timeout:
    #     type: default                                           # none | default | custom
    #     value: 30                                               # Timeout in seconds (used if type is custom or default)
    #   # --- Escalation configuration ---
    #   escalation:
    #     mailEnabled: true
    #     smsEnabled: true
    #     mailAddress: "monitoring@pcg.io"
    #     smsAddress: "0123456789"
    #     minFailureCount: 1
    #     triggers:
    #       everyChange: true
    #       toRed: false
    #       toYellow: false
    #       toGreen: true

  tasks:
    - name: Include hana_backup role
      include_role:
        name: hana_backup